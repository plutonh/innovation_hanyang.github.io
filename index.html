<!-- <!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Scrolling Nav - Start Bootstrap Template</title>
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <!-- <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
            <div class="container px-4">
                <a class="navbar-brand" href="#page-top">Start Bootstrap</a>
                <button class="navbar-toggler" type="button" 매우혼잡-bs-toggle="collapse" 매우혼잡-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a class="nav-link" href="#about">About</a></li>
                        <li class="nav-item"><a class="nav-link" href="#services">Services</a></li>
                        <li class="nav-item"><a class="nav-link" href="#contact">Contact</a></li>
                    </ul>
                </div>
            </div>
        </nav> -->
        <!-- Header-->
        <header class="bg-primary bg-gradient text-white">
            <div class="container px-4 text-center", style = "text-align:center">
                <br> </dr>
                <h1 class="fw-bolder">Welcome to 혁신하냥 Web site!</h1>
                <br> </dr>
                <h3 class="lead">The number of people is uploaded to GitHub every 30 seconds, approximztely, and it takes about a minute to be reflected on the Web site.</h3>
                <br> </dr>
                <h2 class="btn btn-lg btn-light">State: 여유</h2>
                <h2 class="btn btn-lg btn-light">Time: 2022-11-18 16:26:19 </h2>
                <br> </dr>
                <h1 class="fw-bolder"> </h1>
            </div>
        </header>
        <!-- About section-->
        <section id="about">
            <div class="container px-4">
                <div class="row gx-4 justify-content-center">
                    <div class="col-lg-8">
                        <h2>Hardware</h2>
                        <p class="lead">Sensor</p>
                        <ul>
                            <li>'TOF10120' 레이저 센서</li>
                            <li>Serial 통신으로 아두이노와 연결되며 레이저를 이용하여 바로 앞의 사물을 감지하게 됩니다.</li>
                            <br> </dr>
                            <li>'GP2Y0A02' IR 센서</li>
                            <li>아두이노의 아날로그 포트를 통해 연결되며 적외선을 이용하여 레이저 센서에 비해 비교적 넓은 범위를 감지할 수 
                                있으나 감지 속도는 레이저 센서에 비해 느립니다.</li>
                            <br> </dr>
                        </ul>
                        <p class="lead">Arduino Uno</p>
                        <ul>
                            <li>'TOF10120' 레이저 센서와 'GP2Y0A02' IR 센서의 거리 측정 데이터를 수신하며 이를 가공한 데이터를 라즈베리파이로
                                보내게 됩니다.</li>
                        </ul>
                        <p class="lead">Raspberry Pi 4</p>
                        <ul>
                            <li>USB 케이블을 통해 아두이노와 연결되며 아두이노와 각종 센서에 전원을 공급하게 됩니다.</li>
                            <li>아두이노에서 수신한 데이터를 이용하여 혼잡도를 측정한 다음 이를 html 파일에 저장하고 깃허브 원격 저장소인 'innovation_hanyang.github.io'
                                의 웹페이지에 html 파일을 업로드하는 역할을 수행합니다.
                        </ul>
                    </div>
                </div>
            </div>
        </section>
        <section id="about">
            <div class="container px-4">
                <div class="row gx-4 justify-content-center">
                    <div class="col-lg-8">
                        <h2>Software</h2>
                        <p class="lead">Arduino Uno</p>
                        <ul>
                            <ol><h2>Final_code.ino</h2></ol>
                            <h3>핵심 기능</h3>
                            <li>레이저 센서와 IR 센서에서 측정된 각각의 거리 데이터를 이용하여 사람의 출입 방향을 판단하고 현재 인원수를
                                측정합니다.</li>
                            <br> </dr>
                            <h3>보완 사항</h3>
                            <li>레이저 센서와 IR 센서 중 하나의 센서에서 먼저 사물이 감지될 경우 그렇지 않은 센서는 거리 측정 기능을 잠시
                                멈추게 하여 판단의 정확성을 높였습니다.</li>
                            <li>레이저 센서와 IR 센서의 거리 측정 속도 차가 존재하여 출입 방향 판단의 정확성을 감소시키는 요인이 될 수 있습니다.
                                따라서 최대한 같은 시간대의 거리 측정 데이터를 이용여 출입 방향을 판단하도록 레이저 센서에 lock 변수를
                                추가하였습니다. 레이저 센서가 거리를 측정할 때마다 1씩 증가되며 특정한 수보다 커지게 되는 시점에 IR 센서의 데이터와
                                비교하여 출입 방향을 측정하게 됩니다.</li>
                            <br> </dr>
                            <li>소스코드</li>
                            <prev>#include &lt;Wire.h&gt; //i2c library

                                #define TOF10120 0x52 //TOF10120 모듈의 I2C 주소 - A4: blue line, A5: green line
                                #define VOLTS_PER_UNIT .0049F // (.0049 for 10 bit A-D)
                                
                                char Sensor = A0; //Connect sensor to A0
                                int Ic; //Sensor ADC Value Storage Variables
                                float volts;
                                float cm;
                                
                                int lazer;
                                int ultra;
                                int i;
                                int sum_lazer = 0;
                                int sum_Ic = 0;
                                int num1 = 8;
                                int num2 = 4;
                                int count = 0;
                                int lock = 0;
                                int reset = 0;
                                
                                void setup() {
                                  Wire.begin(); //I2C library starts
                                  Serial.begin(9600); //Debugging Serial Monitol starts
                                }
                                
                                void loop() {
                                  POINT:
                                  for(i=0;i<num1;i++) {
                                    lazer = ReadDistance();
                                    sum_lazer+=lazer;
                                  }
                                  for(i=0;i&lt;num2;i++) {
                                    Ic = analogRead(Sensor); &#47;&#47; Store analog values in sensor storage variables
                                    volts = (float)Ic * VOLTS_PER_UNIT; &#47;&#47; Convert analog values in volts
                                    cm = 60.495 * pow(volts,-1.1904); &#47;&#47; Calculation of the distance in cm according to the measured
                                    sum_Ic+=cm;
                                  }
                                  sum_lazer&#47;=num1;
                                  sum_Ic&#47;=(num2+2);
                                  
                                  if(((0.1*sum_lazer) &lt; sum_Ic) && (sum_lazer &lt; 600)) {
                                    lock --;
                                    if(lock >= 1) {
                                      goto POINT;
                                    }
                                    while(1) {
                                      if(sum_lazer > 600)
                                      {
                                        count = count + 1;
                                        break;
                                      }
                                      sum_lazer = ReadDistance();
                                    }
                                  }
                                  else if(((0.1*sum_lazer) > sum_Ic) && (sum_Ic &lt; 60)) {
                                    lock = 10;
                                    while(1) {
                                      if(sum_Ic > 60)
                                      {
                                        count = count - 1;
                                        break;
                                      }
                                      Ic = analogRead(Sensor); // Store analog values in sensor storage variables
                                      volts = (float)Ic * VOLTS_PER_UNIT; // Convert analog values in volts
                                      sum_Ic = 60.495 * pow(volts,-1.1904); // Calculation of the distance in cm according to the measured
                                    }
                                  }
                                  Serial.println(count);
                                  reset += 1;
                                  if(reset > 20000) // approximately 20 minutes 
                                  {
                                    reset = 0;
                                    count = 0;
                                  }
                                  delay(50);
                                }
                                
                                void SensorRead(unsigned char addr,unsigned char* datbuf,unsigned char cnt) {
                                  unsigned short result=0; 
                                  Wire.beginTransmission(TOF10120);
                                  Wire.write(byte(addr));  
                                  Wire.endTransmission();
                                  Wire.requestFrom(TOF10120, (int)cnt);
                                  if (cnt &lt;= Wire.available()) {
                                    *datbuf++ = Wire.read();
                                    *datbuf++ = Wire.read();
                                  }
                                }
                                
                                int ReadDistance() { // Function to read distance 여유 to TOF10120 module    
                                    unsigned short distance;
                                    unsigned char i2c_rx_buf[2]; //Read 2 bytes from 0x00 on the module
                                    SensorRead(0x00,i2c_rx_buf,2);
                                    
                                    //Combine two bytes read into one variable
                                    distance=i2c_rx_buf[0]; // i2c_rx_buf[0] : Top Byte
                                    distance=distance&lt;&lt;8;
                                    distance|=i2c_rx_buf[1]; // i2c_rx_buf[1] : Sub bytes
                                    return distance;
                                }</prev>
                            <br> </dr>
                        </ul>
                        <p class="lead">Raspberry Pi 4</p>
                        <ul>
                            <ol><h2>test.py</h2></ol>
                            <h3>핵심 기능</h3>
                            <li>아두이노로부터 현재 인원수 데이터를 받아온 뒤 20명 미만이면 '양호', 40명 미만이면 '혼잡', 
                                60명 이상이면 '매우 혼잡'을 측정 시각과 함께 웹페이지에 표시합니다.</li>
                            <br></dr>
                            <h3>원리</h3>
                            <li>웹페이지 디자인의 skeleton이 저장된 index_origin.html 파일을 불러와서 '여유' 문자열을 상태메세지(양호, 혼잡 등)으로 
                                변환하고 '2022-11-18 16:26:19 ' 문자열을 데이터 수신 시각으로 변환한 다음 index.html 파일에 저장합니다.</li>
                            <li>아두이노로부터 데이터를 수신할 때마다 'can' 변수를 1씩 증가시키며 can == 1070을 만족하기까지 약 1분 정도가 소요됩니다.
                                깃허브 웹페이지가 새로운 commit을 받을 경우 갱신될 때까지 대략 1분 정도 소요되므로 1분마다 출입 인원수가 갱신되도록 
                                하였습니다.</li>
                            <li>git 패키지를 활용하여 파이썬으로 'git add', 'git commit -m changed_2022-11-18 16:26:19 ' 명령을 구현하였으며 subprocess 
                                패키지를 활용하여 'git push -u origin master' 명령을 구현하였습니다.</li>
                            <prev>from git import Repo
                                import subprocess
                                import git
                                import serial
                                import re
                                import 2022-11-18 16:26:19 
                                
                                port = '/dev/ttyACM0'
                                brate = 9600 #boudrate
                                cmd = 'temp'
                                repo = Repo.init('/home/plutonh')
                                
                                seri = serial.Serial(port, baudrate = brate, 2022-11-18 16:26:19 out = None)
                                seri.write(cmd.encode())
                                #print(seri.name)
                                
                                a = 1
                                can = 0
                                
                                while a:
                                    if seri.in_waiting != 0 :
                                
                                        content = seri.readline()
                                        num = int(content[:-2].decode())
                                
                                        if num &lt; 20:
                                            state = "여유"
                                        elif num &gt;= 20 and num &lt; 40:
                                            state = "보통"
                                        elif num &gt;= 40 and num &lt; 60:
                                            state = "혼잡"
                                        else  :
                                            state = "매우혼잡"
                                
                                        text = open('/home/plutonh/index_origin.html', 'r')
                                        text = text.read()
                                        changed_2022-11-18 16:26:19  = 2022-11-18 16:26:19 .strf2022-11-18 16:26:19 ('%Y-%m-%d %H:%M:%S ', 2022-11-18 16:26:19 .local2022-11-18 16:26:19 (2022-11-18 16:26:19 .2022-11-18 16:26:19 ()))
                                        text = text.replace('여유', state)
                                        text = text.replace('2022-11-18 16:26:19 ', changed_2022-11-18 16:26:19 )
                                
                                        can = can + 1
                                        print(content[:-2].decode(), '\n', can)
                                
                                        with open('/home/plutonh/index.html', 'w') as f:
                                            f.write(text)
                                            f.close()
                                
                                        # adding, commiting and pushing command
                                        if can == 10: # can == 535: approximately 30 seconds
                                            repo.index.add(['index.html'])
                                            repo.index.add(['test.py'])
                                            repo.index.commit(changed_2022-11-18 16:26:19 )
                                            origin = repo.remote(name = 'origin')
                                            subprocess.call("git push -u origin master", shell = True)
                                            can = 0</prev>
                            <br> </dr>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
        <!-- Footer-->
        <footer class="py-5 bg-dark">
            <div class="container px-4"><p class="m-0 text-center text-white">Copyright &copy; Your Website 2022</p></div>
        </footer>
    </body>
</html>
